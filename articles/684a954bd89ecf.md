---
title: "Aikenã§Cardanoã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’æ›¸ã“ã†"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["rust", "aiken", "cardano"]
published: false
published_at: 2023-04-03
---

# é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

# Aikenãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
## Aiken new ã‚³ãƒãƒ³ãƒ‰ã¨æ§‹æˆ

```bash
aiken new aiken-lang/hello_world
cd hello_world
```

```bash:hello_world
./hello_world
â”œâ”€â”€ README.md
â”œâ”€â”€ aiken.toml
â”œâ”€â”€ lib
â”‚   â””â”€â”€ hello_world
â””â”€â”€ validators
```

## æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ç”¨
ç¶šã„ã¦ã€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆã•ã‚ŒãŸ`aiken.toml`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```toml:aiken.toml
name = "aiken-lang/hello_aiken"
version = "0.0.0"
license = "Apache-2.0"
description = "Aiken contracts for project 'ciel/hello_aiken'"

[repository]
user = "aiken-lang"
project = "hello_world"
platform = "github"

[[dependencies]]
name = "aiken-lang/stdlib"
version = "main"
source = "github"
```

## ä¾å­˜é–¢ä¿‚ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
`aiken check` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å‹ãƒã‚§ãƒƒã‚¯ã¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```bash
$ aiken check

---
Resolving versions
  Downloading packages
   Downloaded 1 package in 1.12s
    Compiling aiken-lang/stdlib main (/Users/yoshiki/Desktop/aiken/hello_world/build/packages/aiken-lang-stdlib)
    Compiling aiken-lang/hello_world 0.0.0 (/Users/yoshiki/Desktop/aiken/hello_world)

Summary
    0 errors, 0 warnings
---
```
ä»Šå›ã¯ã¾ã ä¾å­˜é–¢ä¿‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(ç¾æ™‚ç‚¹ã§ã¯`aiken-lang/stdlib`ã®ã¿)ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ã“ã“ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
ç¶šã„ã¦`aiken-lang/stdlib main`ã¨`aiken-lang/hello_world`ãŒæ–¹ãƒã‚§ãƒƒã‚¯ã•ã‚Œã€ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚

ç¶šã‘ã¦`aiken check`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯è¡Œã‚ã‚Œãšã€ãƒ†ã‚¹ãƒˆã®ã¿ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚
ã“ã®ã‚ˆã†ã«ã€Aikenã§ã¯ã€é–‹ç™ºã«å¤‰æ›´ãŒåŠ ãˆã‚‰ã‚Œã‚‹ãŸã³ã«ã“ã¾ã‚ã«`aiken check`ã‚³ãƒãƒ³ãƒ‰ã§å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ãã‚‹ã‚³ãƒ¼ãƒ‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºã‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

# validatorã®ä½œæˆ
ã•ã¦ã€ã“ã“ã‹ã‚‰ã¯ãŠå¾…ã¡ã‹ã­ Aiken ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿéš›ã«æ›¸ã„ã¦ã„ãã¾ã™!

ã¾ãšã¯`validators`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ã€`hello_world.ak`ã‚’ä½œæˆã—ã¾ã™ã€‚Aikenãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ã¯`.ak`ã§ã™ã€‚

```bash
$ touch validators/hello_world.ak
```

## é–¢æ•°ã¨å‹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
ä½œæˆã—ãŸ`hello_world.ak`ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã™ã€‚

```diff rust:validators/hello_world.ak
+ use aiken/hash.{Blake2b_224, Hash}
+ use aiken/list
+ use aiken/transaction.{ScriptContext}
+ use aiken/transaction/credential.{VerificationKey}
```
ã¾ãšã¯`use`ã‚­ãƒ¼ãƒ¯ãƒ‰ã‚’ä½¿ç”¨ã—ã€ aiken ãŒæŒã¤é–¢æ•°ã¨å‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

## ç‹¬è‡ªã®å‹ã‚’å®šç¾©ã™ã‚‹
Aikenã«ã¯`Bool`,`Int`,`ByteArray`,`List`,`Tuples`,`Void`ã®6ã¤ã®å‹ãŒè¨€èªã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ãŒã€é–‹ç™ºä¸­ã«ç‹¬è‡ªã®å‹ãŒå¿…è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
ãã®æ™‚ã¯`type`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ç‹¬è‡ªã®å‹ã‚’å®£è¨€ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```diff rust:validators/hello_world.ak
use aiken/hash.{Blake2b_224, Hash}
use aiken/list
use aiken/transaction.{ScriptContext}
use aiken/transaction/credential.{VerificationKey}

+ type Datum {
+   owner: Hash<Blake2b_224, VerificationKey>,
+ }
+  
+ type Redeemer {
+   msg: ByteArray,
+ }
```
:::message
å‹ã‚·ã‚¹ãƒ†ãƒ ã®æ³¨æ„ç‚¹
å‹ã®å®šç¾©ã§ã¯`{}`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘è¨€èªã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä¼¼ã¦ã„ã¾ã™ãŒã€ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
:::

## validatoré–¢æ•°ã®å®£è¨€
```diff rust:validators/hello_world.ak
use aiken/hash.{Blake2b_224, Hash}
use aiken/list
use aiken/transaction.{ScriptContext}
use aiken/transaction/credential.{VerificationKey}

type Datum {
  owner: Hash<Blake2b_224, VerificationKey>,
}
 
type Redeemer {
  msg: ByteArray,
}

+ validator {
+   fn hello_world(datum: Datum, redeemer: Redeemer, context: ScriptContext) -> Bool {
+     let must_say_hello = redeemer.msg == "Hello, World!"
+  
+     let must_be_signed =
+       list.has(context.transaction.extra_signatories, datum.owner)
+  
+     must_say_hello && must_be_signed
+   }
+ }
```

## aiken build ã§ãƒ“ãƒ«ãƒ‰
validatorãŒå®Œæˆã—ãŸã®ã§æœ€å¾Œã«`aiken build`ã‚’å®Ÿè¡Œã—ã€ãƒ“ãƒ«ãƒ‰ã—ã¾ã—ã‚‡ã†ï¼
```bash
$ aiken build

---
Compiling aiken-lang/stdlib main (/Users/yoshiki/Desktop/aiken/hello_world/build/packages/aiken-lang-stdlib)
    Compiling aiken-lang/hello_world 0.0.0 (/Users/yoshiki/Desktop/aiken/hello_world)
   Generating project's blueprint (/Users/yoshiki/Desktop/aiken/hello_world/plutus.json)

Summary
    0 errors, 0 warnings
---
```
ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã¨`aiken-lang/hello_world`ãŒæ­£å¸¸ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ã‚¨ãƒ©ãƒ¼ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼ğŸ¥³

`aiken build`ã‚³ãƒãƒ³ãƒ‰ã§ã¯ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‹ã¨ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`plutus.json`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯[CIP-0057](https://github.com/cardano-foundation/CIPs/pull/258)ã§ç¾åœ¨è­°è«–ã•ã‚Œã¦ã„ã‚‹ã€ã€ŒPlutusã«ãŠã‘ã‚‹ãã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®æ¤œè¨¼ãƒ«ãƒ¼ãƒ«ç­‰ãŒè¨˜è¼‰ã•ã‚ŒãŸä»•æ§˜æ›¸ã€ã§ã‚ã‚Šã€Aikenã§ã¯æ—¢ã«ã“ã®ä»•æ§˜æ›¸ãŒå®Œå…¨ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ“ãƒ«ãƒ‰ã—ãŸéš›ã«è‡ªå‹•ã§ç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

# Lucid
## Preview Testnetã‚¢ãƒ‰ãƒ¬ã‚¹ä½œæˆã¨tADAã®å–å¾—
ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨è³‡é‡‘ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»Šå›ã¯å®Ÿé¨“çš„ãªé–‹ç™ºã§ã‚ã‚‹ãŸã‚ã€Cardano ã®ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã§ã‚ã‚‹ Preview Testnet ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ tADA(testnetç”¨ã®ADA)ã‚’ç”¨æ„ã—ã¦ã„ãã™ã€‚

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`generate-credentials.ts`ã¨ã„ã†åå‰ã§Typescriptã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
$ touch generate-credentials.ts
```

`generate-credentials.ts` ã«ä»¥ä¸‹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

```ts:./generate-credentials.ts
import { Lucid } from "https://deno.land/x/lucid@0.8.3/mod.ts";
 
const lucid = await Lucid.new(undefined, "Preview");
 
const privateKey = lucid.utils.generatePrivateKey();
await Deno.writeTextFile("key.sk", privateKey);
 
const address = await lucid
  .selectWalletFromPrivateKey(privateKey)
  .wallet.address();
await Deno.writeTextFile("key.addr", address);
```

ãƒ«ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€`Deno run`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
å®Ÿè¡Œã™ã‚‹ã¨ç§˜å¯†éµãŒæ›¸ã‹ã‚ŒãŸ`key.sk`ã¨ã€ãã®å…¬é–‹éµ(ã‚¢ãƒ‰ãƒ¬ã‚¹)ãŒæ›¸ã‹ã‚ŒãŸ`key.addr`ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```bash
$ deno run --allow-net --allow-write generate-credentials.ts
```

ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆç”¨ã®ADA(tADA)ã¯ã€[Testnets faucet](https://docs.cardano.org/cardano-testnet/tools/faucet)ã§å–å¾—ã§ãã¾ã™ã€‚

:::message
ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹å¾Œã€ã€ŒPreview Testnetã€ã¨ã€ŒReceive test ADAã€ãŒé¸æŠã•ã‚ŒãŸçŠ¶æ…‹ã§ã€Addresså…¥åŠ›æ¬„ã«`key.addr`ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã‚Œãã ã•ã„ã€‚
:::

## å®Ÿéš›ã«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦ã¿ã‚ˆã†
ã“ã“ã¾ã§ã®æµã‚Œã§ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å®Ÿè¡Œã«å¿…è¦ãªã€Œã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒ»ã€Œé€å—ä¿¡ç”¨ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ»ã€ŒtADAã€ãŒæƒã£ãŸã®ã§å®Ÿéš›ã«ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`hello_world-lock.ts`ã‚’ä½œæˆã—ã€å¿…è¦ãªé–¢æ•°ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨ Lucid ã®åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚
- `BLOCKFROST_API_KEY`ã®éƒ¨åˆ†ã‚’ã”è‡ªèº«ã®(Blockfrost)[]ã® PROJECT ID ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

```ts:./hello_world-lock.ts
import {
  Blockfrost,
  C,
  Constr,
  Data,
  Lucid,
  SpendingValidator,
  TxHash,
  fromHex,
  toHex,
  utf8ToHex,
} from "https://deno.land/x/lucid@0.8.3/mod.ts";
import * as cbor from "https://deno.land/x/cbor@v1.4.1/index.js";

// "BLOCKFROST_API_KEY" ã®éƒ¨åˆ†ã‚’ã”è‡ªèº«ã® Blockfrost ã®APIã‚­ãƒ¼ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

const lucid = await Lucid.new(
  new Blockfrost(
    "https://cardano-preview.blockfrost.io/api/v0",
    "BLOCKFROST_API_KEY"
  ),
  "Preview"
);
```

```ts:./hello_world-lock.ts
lucid.selectWalletFromPrivateKey(await Deno.readTextFile("./key.sk"));
 
const validator = await readValidator();
 
// --- Supporting functions
 
async function readValidator(): Promise<SpendingValidator> {
  const validator = JSON.parse(await Deno.readTextFile("plutus.json")).validators[0];
  return {
    type: "PlutusV2",
    script: toHex(cbor.encode(fromHex(validator.compiledCode))),
  };
}
```

```ts:./hello_world-lock.ts
const publicKeyHash = lucid.utils.getAddressDetails(
  await lucid.wallet.address()
).paymentCredential?.hash;
 
const datum = Data.to(new Constr(0, [publicKeyHash]));
 
const txHash = await lock(1000000n, { into: validator, owner: datum });
 
await lucid.awaitTx(txHash);
 
console.log(`1 tADA locked into the contract at:
    Tx ID: ${txHash}
    Datum: ${datum}
`);
 
// --- Supporting functions
 
async function lock(
  lovelace: bigint,
  { into, owner }: { into: SpendingValidator; owner: string }
): Promise<TxHash> {
  const contractAddress = lucid.utils.validatorToAddress(into);
 
  const tx = await lucid
    .newTx()
    .payToContract(contractAddress, { inline: owner }, { lovelace })
    .complete();
 
  const signedTx = await tx.sign().complete();
 
  return signedTx.submit();
}
```

`deno run`ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
$ deno run --allow-net --allow-read --allow-env hello_world-lock.ts

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®æˆ»ã‚Šå€¤
---
1 tADA locked into the contract at:
    Tx ID: b05c0b203beb09dcb8705bd1c3b392f6f478774a2a2cab2b20bc261a73a6b987
    Datum: d8799f581c2fc5df6a7876b5b45930f14ff5df44cf959e2ce421af2add68385a93ff
---
```

